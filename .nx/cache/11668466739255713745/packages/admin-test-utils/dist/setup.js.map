{"version":3,"file":"setup.js","sources":["../src/setup.ts"],"sourcesContent":["import { format } from 'util';\nimport { ResizeObserver } from '@juggle/resize-observer';\n\n/* -------------------------------------------------------------------------------------------------\n * IntersectionObserver\n * -----------------------------------------------------------------------------------------------*/\n\nconst mockIntersectionObserver = jest.fn();\nmockIntersectionObserver.mockReturnValue({\n  observe: () => null,\n  unobserve: () => null,\n  disconnect: () => null,\n});\nwindow.IntersectionObserver = mockIntersectionObserver;\n\n/* -------------------------------------------------------------------------------------------------\n * ResizeObserver\n * -----------------------------------------------------------------------------------------------*/\n\nwindow.ResizeObserver = ResizeObserver;\n\n/* -------------------------------------------------------------------------------------------------\n * requestIdleCallback\n * -----------------------------------------------------------------------------------------------*/\n\ntype SetTimeout = typeof window.setTimeout;\n\nwindow.setImmediate =\n  window.setImmediate ||\n  ((fn: Parameters<SetTimeout>[0], ...args: any[]) => window.setTimeout(fn, 0, ...args));\n\nwindow.clearImmediate = window.clearImmediate || window.clearTimeout;\n\n// @ts-expect-error – mocking for testing\nwindow.requestIdleCallback = setImmediate;\n// @ts-expect-error – mocking for testing\nwindow.cancelIdleCallback = clearImmediate;\n\n/* -------------------------------------------------------------------------------------------------\n * ResizeObserver\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * If there's a prop type error then we want to throw an\n * error so that the test fails.\n *\n * In the CI we fail the entire process if anything is logged to the console.\n * This is to stop pollution, you shouldn't need to log _anything_ to the console\n * for tests.\n */\nwindow.console = {\n  ...window.console,\n  warn(...args: any[]) {\n    throw new Error(format(...args));\n  },\n  error(...args: any[]) {\n    const message = format(...args);\n\n    if (/(Invalid prop|Failed prop type)/gi.test(message)) {\n      throw new Error(message);\n\n      // Ignore errors thrown by styled-components. This can be removed once we upgrade\n      // to styled-components@6 and have separate props that are rendered in the DOM by\n      // the ones that aren't using the $ prefix.\n      // https://styled-components.com/docs/faqs#transient-as-and-forwardedas-props-have-been-dropped\n    } else if (\n      /React does not recognize the .* prop on a DOM element/.test(message) ||\n      /Unknown event handler property/.test(message)\n    ) {\n      // do nothing\n    } else if (/Support for defaultProps will be removed/gi.test(message)) {\n      // do nothing\n    } else {\n      throw new Error(message);\n    }\n  },\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Strapi\n * -----------------------------------------------------------------------------------------------*/\n\nwindow.strapi = {\n  backendURL: 'http://192.168.20.14:1337',\n  isEE: false,\n  features: {\n    SSO: 'sso',\n    isEnabled: () => false,\n  },\n  future: {\n    isEnabled: () => false,\n  },\n  projectType: 'Community',\n  telemetryDisabled: true,\n  flags: {\n    nps: true,\n    promoteEE: true,\n  },\n};\n\n/* -------------------------------------------------------------------------------------------------\n * matchMedia\n * -----------------------------------------------------------------------------------------------*/\n\nObject.defineProperty(window, 'matchMedia', {\n  writable: true,\n  value: jest.fn().mockImplementation((query) => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    /**\n     * @deprecated\n     */\n    addListener: jest.fn(),\n    /**\n     * @deprecated\n     */\n    removeListener: jest.fn(),\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    dispatchEvent: jest.fn(),\n  })),\n});\n\n/* -------------------------------------------------------------------------------------------------\n * scrollTo\n * -----------------------------------------------------------------------------------------------*/\n\nObject.defineProperty(window, 'scrollTo', {\n  writable: true,\n  value: jest.fn(),\n});\n\n/* -------------------------------------------------------------------------------------------------\n * prompt\n * -----------------------------------------------------------------------------------------------*/\n\nObject.defineProperty(window, 'prompt', {\n  writable: true,\n  value: jest.fn(),\n});\n\n/* -------------------------------------------------------------------------------------------------\n * URL\n * -----------------------------------------------------------------------------------------------*/\n\nwindow.URL.createObjectURL = jest\n  .fn()\n  .mockImplementation((file) => `http://localhost:4000/assets/${file.name}`);\n\n/* -------------------------------------------------------------------------------------------------\n * createRange\n * -----------------------------------------------------------------------------------------------*/\n\ndocument.createRange = () => {\n  const range = new Range();\n  // @ts-expect-error we don't need to implement all the methods\n  range.getClientRects = jest.fn(() => ({\n    item: () => null,\n    length: 0,\n  }));\n\n  return range;\n};\n\n/* -------------------------------------------------------------------------------------------------\n * localStorage\n * -----------------------------------------------------------------------------------------------*/\n\nclass LocalStorageMock {\n  store: Map<string, string>;\n\n  constructor() {\n    this.store = new Map();\n  }\n\n  clear() {\n    this.store.clear();\n  }\n\n  getItem(key: string) {\n    /**\n     * We return null to avoid returning `undefined`\n     * because `undefined` is not a valid JSON value.\n     */\n    return this.store.get(key) ?? null;\n  }\n\n  setItem(key: string, value: unknown) {\n    this.store.set(key, String(value));\n  }\n\n  removeItem(key: string) {\n    this.store.delete(key);\n  }\n\n  get length() {\n    return this.store.size;\n  }\n}\n\nObject.defineProperty(window, 'localStorage', {\n  writable: true,\n  value: new LocalStorageMock(),\n});\n\n/* -------------------------------------------------------------------------------------------------\n * PointerEvents\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * JSDOM doesn't implement PointerEvent so we need to mock our own implementation\n * Default to mouse left click interaction\n * https://github.com/radix-ui/primitives/issues/1822\n * https://github.com/jsdom/jsdom/pull/2666\n */\nclass MockPointerEvent extends Event {\n  button: number;\n\n  ctrlKey: boolean;\n\n  pointerType: string;\n\n  constructor(\n    type: string,\n    props: EventInit & { button?: number; ctrlKey?: boolean; pointerType?: string }\n  ) {\n    super(type, props);\n    this.button = props.button || 0;\n    this.ctrlKey = props.ctrlKey || false;\n    this.pointerType = props.pointerType || 'mouse';\n  }\n}\n\nObject.defineProperty(window, 'PointerEvent', {\n  writable: true,\n  value: MockPointerEvent,\n});\n\nwindow.HTMLElement.prototype.scrollIntoView = jest.fn();\nwindow.HTMLElement.prototype.releasePointerCapture = jest.fn();\nwindow.HTMLElement.prototype.hasPointerCapture = jest.fn();\n\n/* -------------------------------------------------------------------------------------------------\n * Navigator\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * Navigator is a large object so we only mock the properties we need.\n */\nObject.assign(navigator, {\n  clipboard: {\n    writeText: jest.fn(),\n  },\n});\n"],"names":["ResizeObserver","format"],"mappings":"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"}